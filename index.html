<!--Auteur: Robbe Wulgaert / aiindeklas.be-->
<!-- Copyright 2025 - Gebruik vrij voor educatie -->

<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#5200FF" />
  <title>Interactieve Stressmeter</title>

  <!-- Snellere fontlaad via preconnect + link (vervangt @import) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet" />

  <!-- Voor didactisch gebruik aangepast door Robbe Wulgaert, Sint-Lievenscollege Gent / AI in de Klas -->
  <style>
    /* Basiskleuren en layout-variabelen */
    :root{--white:#fff;--primary:#5200FF;--secondary:#00FF99;--header-h:20vh;--main-h:70vh;--footer-h:10vh}

    /* Reset en basis */
    *{box-sizing:border-box;margin:0;padding:0}
    html, body{height:100%}
    body{font-family:'Roboto',sans-serif;font-weight:900;font-size:14px;background:var(--white)}

    /* Secties */
    .header{height:var(--header-h);background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center}
    .main{height:var(--main-h);padding:1rem;overflow-y:auto}
    .footer{height:var(--footer-h);background:var(--secondary);display:flex;align-items:center;justify-content:center}
    .footer small{color:#333}

    /* Controls */
    #controls{display:flex;flex-wrap:wrap;align-items:center;margin-bottom:1rem}
    #controls button{margin-right:.5rem;padding:.5rem 1rem;font-size:1rem;background:var(--primary);color:#fff;border:none;cursor:pointer}
    #controls button[disabled]{opacity:.4;cursor:not-allowed}
    #debug{margin-left:auto;font-size:1rem;color:var(--primary)}

    /* Grafiek-canvas (responsief) */
    #stress-chart{border:1px solid #ccc;width:100%;max-width:100%;height:40vh;}

    /* ===== Helpknop en overlay (vraagteken) ===== */
    .help-btn{
      position:fixed; right:1rem; bottom:1rem;
      width:56px; height:56px; border-radius:9999px;
      background:var(--primary); color:#fff; border:none; cursor:pointer;
      font-size:1.25rem; font-weight:900; box-shadow:0 8px 20px rgba(0,0,0,.25);
    }
    .help-btn:focus-visible, .overlay-close:focus-visible, #controls button:focus-visible{
      outline:3px solid var(--secondary); outline-offset:2px;
    }

    /* Overlay basis */
    .overlay.hidden{ display:none; }
    .overlay{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.7); z-index:1000; padding:1rem;
    }
    .overlay-card{
      position:relative;
      background:#fff; color:#222; width:min(720px, 92vw); max-height:85vh; overflow:auto;
      border-radius:16px; padding:1.25rem 1.25rem 1.5rem; box-shadow:0 12px 32px rgba(0,0,0,.35);
    }
    .overlay-close{
      position:absolute; top:.5rem; right:.75rem; background:transparent; border:none; font-size:1.25rem; cursor:pointer;
    }
    .overlay-list{ margin:.5rem 0 1rem 1rem; }
    .overlay-list li{ margin:.35rem 0; }

    /* ===== Statusbadge ‚ÄúVerbonden/Niet verbonden‚Äù ===== */
    .status-badge{
      display:inline-block; margin-left:.75rem; padding:.15rem .5rem; border-radius:9999px; font-size:.9rem;
      border:1px solid #ccc; vertical-align:middle;
    }
    .status-badge::before{
      content:""; display:inline-block; width:.5rem; height:.5rem; border-radius:9999px; margin-right:.4rem; vertical-align:middle;
      background:#bbb;
    }
    .status-on{ border-color:#1e7f33; color:#1e7f33; }
    .status-on::before{ background:#1e7f33; }
    .status-off{ border-color:#a33; color:#a33; }
    .status-off::before{ background:#a33; }
    :root{
  /* Merk */
  --primary:   #5200FF;       /* paars (al in je code) */
  --secondary: #00FF99;       /* je huidige secundaire/accent */
  /* Semantisch */
  --bg:        #ffffff;
  --text:      #23272e;
  --surface:   #ffffff;       /* kaarten/canvas/overlay-kaarten */
  --surface-2: #f7f8fa;       /* lichte vlakken */
  --border:    #cccccc;
  --grid:      #cccccc;       /* grafiek rasterlijnen */
  --label:     #000000;       /* grafiek labels */
}

/* Donkere modus */
.dark{
  --bg:        #161820;
  --text:      #ffffff;
  --surface:   #23272e;
  --surface-2: #23272e;
  --border:    #3a3f4a;
  --grid:      #3a3f4a;
  --label:     #e7e7e7;
}

/* Pas basis op variabelen toe (geen structurele refactor nodig) */
html, body{ background: var(--bg); color: var(--text); }
.header{ position: relative; } /* voor de toggle-knop positionering */
.main{ background: var(--bg); }
.footer small{ color: var(--text); opacity:.9; }

/* Canvas & kaart-onderdelen kleuren met variabelen */
#stress-chart{
  border:1px solid var(--border);
  background: var(--surface);   /* geeft contrasterende ‚Äúkaart‚Äù look in dark mode */
}

/* Overlay-kaart in donker thema */
.dark .overlay-card{
  background: var(--surface);
  color: var(--text);
}

/* Debug-tekst leest goed op beide thema's */
#debug{ color: var(--primary); }

/* Knoppen: houd merkpaars consistent; wil je donker-thema knoppen wit/paarse tekst? uncomment hieronder
.dark #controls button{
  background: #ffffff;
  color: var(--primary);
  border: 1.5px solid var(--primary);
}
.dark #controls button:hover{ filter: brightness(1.05); }
*/

/* ===== NL: Toggle-knop stijl ===== */
.theme-btn{
  position:absolute; right:12px; top:12px;
  width:40px; height:40px; border-radius:9999px; border:1px solid transparent;
  background: var(--surface); color: var(--text); cursor:pointer;
  box-shadow: 0 6px 20px rgba(0,0,0,.20);
  display:flex; align-items:center; justify-content:center;
  transition: background .2s, color .2s, border-color .2s, transform .1s;
}
.theme-btn:hover{ transform: translateY(-1px); }
.dark .theme-btn{ border-color: var(--border); }

/* Status-badge randen in dark mode subtieler */
.dark .status-badge{ border-color: var(--border); }
  </style>

  <!-- Bibliotheken -->
  <script src="https://cdn.jsdelivr.net/npm/smoothie@1.36/smoothie.min.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <noscript>
    <p style="padding:1rem;background:#fee;border-left:4px solid #f66;">
      JavaScript is vereist voor deze app. Schakel JavaScript in of gebruik een andere browser.
    </p>
  </noscript>

  <div class="header"><h1>Interactieve Stressmeter</h1></div>

  <div class="main">
    <!-- Groep van bedieningsknoppen -->
    <div id="controls" role="toolbar" aria-label="Meet- en bedieningsknoppen">
      <button id="connectButton">Verbind met microcontroller</button>
      <button id="btn-calibrate" disabled>Kalibreer (rust)</button>
      <button id="btn-whatsapp" disabled>WhatsApp</button>
      <button id="btn-messenger" disabled>Messenger</button>
      <button id="btn-teams" disabled>Teams</button>
      <button id="btn-sequence" disabled>Speel sequentie</button>
      <button id="btn-theme" class="theme-btn" aria-pressed="false" title="Wissel thema">üåô</button>

      <!-- Debug + statusbadge -->
      <div id="debug" aria-live="polite">
        Laatste: <span id="value-display">--</span> |
        Norm: <span id="norm-display">--%</span>
        <span id="status-badge" class="status-badge status-off" title="Seri√´le status">Niet verbonden</span>
      </div>
    </div>

    <!-- Canvas voor de live-grafiek -->
    <canvas id="stress-chart" width="800" height="300"></canvas>

    <!-- Geluiden voor meldingen -->
    <audio id="audio-whatsapp" src="media/whatsapp.mp3" preload="auto"></audio>
    <audio id="audio-messenger" src="media/messenger.mp3" preload="auto"></audio>
    <audio id="audio-teams"    src="media/teams.mp3"    preload="auto"></audio>
  </div>

  <!-- Help-knop (zwevend) -->
  <button id="btn-help" class="help-btn" aria-haspopup="dialog" aria-controls="overlay-help" aria-label="Toon uitleg">?</button>

  <!-- Help-overlay (modal) -->
  <div id="overlay-help" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="help-title">
    <div class="overlay-card">
      <button id="btn-close-help" class="overlay-close" aria-label="Sluit hulpvenster">‚úï</button>
      <h2 id="help-title" tabindex="-1">Wat moet je doen?</h2>
      <ol class="overlay-list">
        <li>Verbind: klik <strong>‚ÄúVerbind met microcontroller‚Äù</strong> en kies de juiste COM-poort.</li>
        <li>Bevestig elektrodes: twee muntjes op je vingers. E√©n munt naar <strong>5 V</strong>, de andere naar <strong>A0</strong>. <em>10 kŒ©</em> tussen <strong>A0</strong> en <strong>GND</strong>.</li>
        <li>Kalibreer: klik <strong>‚ÄúKalibreer (rust)‚Äù</strong> en zit 10 s stil.</li>
        <li>Test: speel een melding (WhatsApp, Messenger, Teams) en kijk naar de grafiek.</li>
        <li>Onderzoek: welke melding geeft de grootste piek? Herhaal 3√ó voor betrouwbaarheid.</li>
      </ol>

      <hr>

      <h3>Legenda grafiek</h3>
      <ul class="overlay-list">
        <li><strong>Blauwe lijn</strong>: jouw genormaliseerde GSR (0‚Äì100%).</li>
        <li><strong>Rode streepjes</strong>: tijdstip waarop een meldingsgeluid gespeeld werd.</li>
      </ul>

      <details>
        <summary>Belangrijk om te weten!</summary>
        <p>GSR meet geleidbaarheid van de huid (zweet/vocht). Het is <em>geen</em> directe emotie-meter.
        Werk met toestemming, deel geen ruwe data buiten de klascontext.</p>
      </details>
    </div>
  </div>

  <div class="footer"><small>¬© 2025 Robbe Wulgaert ¬∑ AI in de Klas</small></div>
</body>
</html>
